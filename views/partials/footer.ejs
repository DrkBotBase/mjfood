  <script src="/js/pwa-handler.js"></script>
  <script src="/js/push.js"></script>
  <script>
    function showUpdateBanner(newWorker) {
        if (document.getElementById('pwa-update-banner')) {
            return;
        }
        const banner = document.createElement('div');
        banner.id = 'pwa-update-banner';
        const message = document.createElement('p');
        message.textContent = '¡Nueva versión disponible!';
        const updateButton = document.createElement('button');
        updateButton.id = 'pwa-update-button';
        updateButton.textContent = 'Actualizar';
        updateButton.addEventListener('click', () => {
            newWorker.postMessage({ action: 'skipWaiting' });
            banner.remove();
        });
        const closeButton = document.createElement('button');
        closeButton.id = 'pwa-close-button';
        closeButton.textContent = 'Ahora no';
        closeButton.addEventListener('click', () => {
            banner.remove();
        });
        banner.appendChild(message);
        banner.appendChild(updateButton);
        banner.appendChild(closeButton);
        document.body.appendChild(banner);
        styleUpdateBanner();
    }
    function styleUpdateBanner() {
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInUp {
                from {
                    transform: translate(-50%, 100%);
                    opacity: 0;
                }
                to {
                    transform: translate(-50%, 0);
                    opacity: 1;
                }
            }
            #pwa-update-banner {
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background-color: #2d3748; /* Un gris oscuro */
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
                z-index: 2000;
                display: flex;
                align-items: center;
                gap: 15px;
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
                animation: slideInUp 0.5s ease-out forwards;
            }
            #pwa-update-banner p {
                margin: 0;
                font-size: 15px;
            }
            #pwa-update-banner button {
                border: none;
                border-radius: 5px;
                padding: 8px 12px;
                cursor: pointer;
                font-weight: bold;
                transition: background-color 0.2s;
            }
            #pwa-update-button {
                background-color: #38a169; /* Verde */
                color: white;
            }
            #pwa-update-button:hover {
                background-color: #2f855a;
            }
            #pwa-close-button {
                background-color: transparent;
                color: #a0aec0; /* Gris claro */
            }
            #pwa-close-button:hover {
                color: #e2e8f0;
            }
            @media (max-width: 600px) {
                #pwa-update-banner {
                    bottom: 0;
                    left: 0;
                    right: 0;
                    border-radius: 0;
                    justify-content: space-between;
                    padding: 15px;
                    transform: translateX(0);
                }
            }
        `;
        document.head.appendChild(style);
    }
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        const pathSegments = window.location.pathname.split('/').filter(Boolean);
        const restaurante = pathSegments[0] || 'lista';
        
        const swPath = `/${restaurante}/sw.js`;
        const scope = `/${restaurante}/`;
        
        console.log('Registering SW for restaurant:', restaurante);
        
        navigator.serviceWorker.register(swPath, { scope })
          .then((registration) => {
            console.log('✅ SW registered successfully for scope:', registration.scope);
            
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              console.log('New SW version found:', newWorker.state);
              
              newWorker.addEventListener('statechange', () => {
                console.log('SW state changed to:', newWorker.state);
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  if (typeof showUpdateBanner === 'function') {
                    showUpdateBanner(newWorker);
                  }
                }
              });
            });
          })
          .catch((error) => {
            console.log('❌ SW registration failed:', error);
            
            console.log('Error details:', {
              swPath,
              scope,
              currentURL: window.location.href,
              errorMessage: error.message
            });
          });
      });
    
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        console.log('Controller changed, reloading page...');
        window.location.reload();
      });
    }
    
    function showUpdateBanner(newWorker) {
      console.log('New update available!');
      
      const updateBanner = document.createElement('div');
      updateBanner.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: #007bff;
        color: white;
        padding: 10px;
        text-align: center;
        z-index: 10000;
      `;
      updateBanner.innerHTML = `
        Nueva versión disponible! 
        <button onclick="updateSW()" style="margin-left: 10px; padding: 5px 10px;">
          Actualizar
        </button>
      `;
      document.body.appendChild(updateBanner);
    }
    
    function updateSW() {
      if (navigator.serviceWorker.controller) {
        navigator.serviceWorker.controller.postMessage({
          type: 'SKIP_WAITING'
        });
      }
    }
  </script>