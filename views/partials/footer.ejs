  <script src="/js/pwa-handler.js"></script>
  <script src="/js/push.js"></script>
  <script>
  let waitingWorker = null;

  function showUpdateBanner(worker) {
    if (document.getElementById('pwa-update-banner')) return;

    waitingWorker = worker;

    const banner = document.createElement('div');
    banner.id = 'pwa-update-banner';
    banner.style.cssText = `
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #2d3748;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,.2);
      z-index: 9999;
      display: flex;
      gap: 10px;
      align-items: center;
    `;

    banner.innerHTML = `
      <span>¡Nueva versión disponible!</span>
      <button id="pwa-update-btn"
        style="background:#38a169;color:white;padding:6px 10px;border-radius:5px">
        Actualizar
      </button>
      <button id="pwa-close-btn"
        style="background:transparent;color:#a0aec0">
        Ahora no
      </button>
    `;

    document.body.appendChild(banner);

    document.getElementById('pwa-update-btn').onclick = () => {
      waitingWorker.postMessage({ type: 'SKIP_WAITING' });
      banner.remove();
    };

    document.getElementById('pwa-close-btn').onclick = () => {
      banner.remove();
    };
  }

  if ('serviceWorker' in navigator) {
    window.addEventListener('load', async () => {
      try {
        const registration = await navigator.serviceWorker.register('/sw.js');
        //console.log('✅ SW global registrado:', registration.scope);

        if (registration.waiting) {
          showUpdateBanner(registration.waiting);
        }

        registration.addEventListener('updatefound', () => {
          const newWorker = registration.installing;
          newWorker.addEventListener('statechange', () => {
            if (
              newWorker.state === 'installed' &&
              navigator.serviceWorker.controller
            ) {
              showUpdateBanner(newWorker);
            }
          });
        });
      } catch (e) {
        console.error('❌ Error registrando SW:', e);
      }
    });

    navigator.serviceWorker.addEventListener('controllerchange', () => {
      window.location.reload();
    });
  }
</script>